TextIt=window.TextIt||{},TextIt.editor=function(){function e(){TextIt.util.supportsHtmlStorage()?document.onkeyup=function(e){n(e),l()}:document.onkeyup=n,document.onmousedown=n,document.onmouseup=function(e){setTimeout(function(){n(e)},1)},window.addEventListener("resize",function(e){o()}),document.body.addEventListener("scroll",function(){o()}),document.addEventListener("compositionstart",x),document.addEventListener("compositionend",T)}function t(){y=document.querySelector(".header"),C=document.querySelector(".content"),q=document.querySelector(".text-options"),h=q.querySelector(".options"),(H=q.querySelector(".bold")).onclick=m,(b=q.querySelector(".italic")).onclick=f,(I=q.querySelector(".quote")).onclick=p,(R=q.querySelector(".url")).onmousedown=g,(A=q.querySelector(".url-input")).onblur=w,A.onkeydown=S}function n(e){var t=window.getSelection();if("url-input"===e.target.className||e.target.classList.contains("url")||e.target.parentNode.classList.contains("ui-inputs"))return k=a(t.focusNode),void c();!0===t.isCollapsed&&!1===L&&i(),!1===t.isCollapsed&&!1===E&&u(k=a(t.focusNode),"ARTICLE")&&(c(),o(),q.className="text-options active"),L=t.isCollapsed}function o(){var e=window.getSelection().getRangeAt(0).getBoundingClientRect();q.style.top=e.top-5+window.pageYOffset+"px",q.style.left=(e.left+e.right)/2+"px"}function c(){u(k,"B")?H.className="bold active":H.className="bold",u(k,"I")?b.className="italic active":b.className="italic",u(k,"BLOCKQUOTE")?I.className="quote active":I.className="quote",u(k,"A")?R.className="url useicons active":R.className="url useicons"}function i(){q.className="text-options fade",setTimeout(function(){"text-options fade"==q.className&&(q.className="text-options",q.style.top="-999px",q.style.left="-999px")},260)}function a(e){var t={};for(window.getSelection();e.parentNode;)t[e.nodeName]=!0,"A"===(e=e.parentNode).nodeName&&(t.url=e.href);return t}function u(e,t){return!!e[t]}function l(e){localStorage.header=y.innerHTML,localStorage.content=C.innerHTML}function s(){localStorage.header?y.innerHTML=localStorage.header:y.innerHTML=defaultTitle,localStorage.content?C.innerHTML=localStorage.content:d()}function r(){y.innerHTML=defaultTitle,d()}function d(){C.innerHTML=defaultContent}function m(){document.execCommand("bold",!1)}function f(){document.execCommand("italic",!1)}function p(){u(a(window.getSelection().focusNode),"BLOCKQUOTE")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"blockquote")}function g(){"options"==h.className?(h.className="options url-mode",setTimeout(function(){var e=a(window.getSelection().focusNode);u(e,"A")?A.value=e.url:document.execCommand("createLink",!1,"/"),lastSelection=window.getSelection().getRangeAt(0),L=!1,A.focus()},100)):h.className="options"}function S(e){13===e.keyCode&&(e.preventDefault(),N(A.value),A.blur())}function w(e){h.className="options",N(A.value),A.value="",k=a(window.getSelection().focusNode),c()}function N(e){v(),document.execCommand("unlink",!1),""!==e&&(e.match("^(http|https)://")||(e="http://"+e),document.execCommand("createLink",!1,e))}function v(){window.getSelection().addRange(lastSelection)}function x(e){E=!0}function T(e){E=!1}var y,C,L,k,q,h,H,b,I,R,A,E;return{init:function(){E=!1,t(),e(),TextIt.util.supportsHtmlStorage()?s():r();var n=document.createRange(),o=window.getSelection();n.setStart(y,1),o.removeAllRanges(),o.addRange(n)},saveState:l,getWordCount:function(){var e=TextIt.util.getText(C);return""===e?0:e.split(/\s+/).length}}}();